<%- include('../layouts/admin-header') %>

<h2>Add a product</h2>
<a class="btn btn-primary" href="/admin/products">Back to all products</a>
<br><br>

<form method="POST" action="/admin/add-product" enctype="multipart/form-data">
     <!-- <% if(valErrors) {
          valErrors.forEach(err => { %>
               <div class="alert alert-danger"><%= err.msg %></div>
          <% });
     } %> -->
     <% if(valErrors.find(err => err.param === 'title')) { 
          const index = valErrors.findIndex(err => err.param === 'title'); %>
          <div class="alert alert-danger"><%= valErrors[index].msg %></div>
     <% } %>
     <div class="form-group">
          <label>Name</label>
          <input class="form-control" type="text" name="title" value="<%= oldInput.title %>" placeholder="Name">
     </div>

     <div class="form-group">
          <label>Slug</label>
          <input class="form-control" type="text" name="slug" value="<%= oldInput.slug %>" placeholder="Slug">
     </div>

     <% if(valErrors.find(err => err.param === 'price')) { 
          const index = valErrors.findIndex(err => err.param === 'price'); %>
          <div class="alert alert-danger"><%= valErrors[index].msg %></div>
     <% } %>
     <div class="form-group">
          <label>Price</label>
          <input class="form-control" type="text" name="price" value="<%= oldInput.price %>" placeholder="$">
     </div>

     <% if(valErrors.find(err => err.param === 'category')) { 
          const index = valErrors.findIndex(err => err.param === 'category'); %>
          <div class="alert alert-danger"><%= valErrors[index].msg %></div>
     <% } %>
     <div class="form-group">
          <label>Category</label>
          <select class="form-control" name="category">
               <<option value="">Choose category</option>
               <% categories.forEach(category => { %>
                    <option value="<%= category.slug %>" <% if(oldInput.category === category.slug) { %>selected<% } %> ><%= category.title %></option>
               <% }) %>
          </select>
     </div>

     <div class="form-group">
          <label>Image</label>
          <div class="custom-file">
          	<!--  JS ONCHANGE EVENT for showing the preview of an uploaded image  -->      
               <input class="custom-file-input" type="file" name="image" onchange="document.getElementById('imgPreview').style.display = 'block'; document.getElementById('imgPreview').src = window.URL.createObjectURL(this.files[0]); document.getElementById('imgPreview').width = 100; document.getElementById('imgPreview').height = 100">
               <label class="custom-file-label">Choose file</label>
          </div>
          <img src="#" id="imgPreview">
     </div>

     <% if(valErrors.find(err => err.param === 'description')) { 
          const index = valErrors.findIndex(err => err.param === 'description'); %>
          <div class="alert alert-danger"><%= valErrors[index].msg %></div>
     <% } %>
     <div class="form-group">
          <label>Description</label>
          <textarea id="editor" class="form-control" name="description" cols="25" rows="10" placeholder="Description"><%= oldInput.description %></textarea>
     </div>
     
     <input type="hidden" name="_csrf" value="<%= csrfToken %>">
     <button type="submit" class="btn btn-outline-secondary">Submit</button>
</form>

<%- include('../layouts/admin-footer') %>